{% set isIndex = 'index' == tmpl ? true : false %}
{% set tmpl = 'list' %}
{% extends isIndex ? '@MauticCore/Default/content.html.twig' : '@MauticCore/Default/raw_output.html.twig' %}
{% block mauticContent %}event{% endblock %}

{% block headerTitle %}{{ 'mautic.events.header.index'|trans }}{% endblock %}

{% block content %}
    {% if isIndex %}
        <div id="page-list-wrapper" class="panel panel-default">
            {{ include('@MauticCore/Helper/list_toolbar.html.twig', {
                'searchValue': searchValue,
                'action': currentRoute,
                'page_actions': {
                    'templateButtons': {
                        'new': permissions['events:events:create']
                    },
                    'routeBase': 'event',
                    'langVar': 'events'
                },
                'bulk_actions': {
                    'langVar': 'events',
                    'routeBase': 'event',
                    'templateButtons': {
                        'delete': permissions['events:events:delete']
                    }
                },
                'quickFilters': [
                    {
                        'search': 'status:active',
                        'label': 'mautic.events.filter.active',
                        'tooltip': 'mautic.events.filter.active.tooltip',
                        'icon': 'ri-check-line'
                    },
                    {
                        'search': 'status:inactive',
                        'label': 'mautic.events.filter.inactive',
                        'tooltip': 'mautic.events.filter.inactive.tooltip',
                        'icon': 'ri-close-line'
                    }
                ]
            }) }}
            <div class="page-list">
                {{ block('mainContent') }}
            </div>
        </div>
    {% else %}
        {{ block('mainContent') }}
    {% endif %}
{% endblock %}

{% block mainContent %}
    {% if items is defined and items is not empty %}
        <div class="table-responsive">
            <table class="table table-hover" id="eventTable">
                <thead>
                    <tr>
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'checkall': 'true',
                            'target': '#eventTable'
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.id',
                            'text': 'mautic.core.id',
                            'class': 'visible-md visible-lg'
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.name',
                            'text': 'mautic.events.name',
                            'default': true
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.eventOrganizerC',
                            'text': 'mautic.events.organizer',
                            'class': 'visible-md visible-lg'
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.eventRoundC',
                            'text': 'mautic.events.round',
                            'class': 'visible-lg'
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.eventCityC',
                            'text': 'mautic.events.location',
                            'class': 'visible-md visible-lg'
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.eventFieldC',
                            'text': 'mautic.events.field',
                            'class': 'visible-lg'
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.activityStatusType',
                            'text': 'mautic.core.status',
                            'class': 'visible-md visible-lg'
                        }) }}
                        {{ include('@MauticCore/Helper/tableheader.html.twig', {
                            'sessionVar': 'event',
                            'orderBy': 'e.eventExternalId',
                            'text': 'mautic.events.event_external_id',
                            'class': 'visible-lg'
                        }) }}
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                        <tr>
                            <td>
                                {% set custom = [{
                                    attr: {
                                        href: path('mautic_event_action', {objectAction: 'view', objectId: item.getId()}),
                                        'data-toggle': 'ajax'
                                    },
                                    btnText: 'mautic.core.details',
                                    iconClass: 'ri-information-line'
                                }] %}
                                {{ include('@MauticCore/Helper/list_actions.html.twig', {
                                    item: item,
                                    templateButtons: {
                                        edit: permissions['events:events:edit'],
                                        delete: permissions['events:events:delete']
                                    },
                                    routeBase: 'event',
                                    langVar: 'events',
                                    customButtons: custom
                                }) }}
                            </td>
                            <td class="visible-md visible-lg">{{ item.getId() }}</td>
                            <td>
                                <div>
                                    <a href="{{ path('mautic_event_action', {objectAction: 'view', objectId: item.getId()}) }}" data-toggle="ajax" class="fw-sb">
                                        {{ item.getName() }}
                                    </a>
                                    {% if item.getEventExternalId() %}
                                        <small class="text-muted ml-2">({{ item.getEventExternalId() }})</small>
                                    {% endif %}
                                </div>
                                {% if item.getDescription() %}
                                    <div class="mt-xs">
                                        <small class="text-muted">{{ item.getDescription()|striptags|slice(0, 80) }}{% if item.getDescription()|striptags|length > 80 %}...{% endif %}</small>
                                    </div>
                                {% endif %}
                            </td>
                            <td class="visible-md visible-lg">
                                {% if item.getEventOrganizerC() %}
                                    <span class="label label-info">{{ item.getEventOrganizerC() }}</span>
                                {% endif %}
                            </td>
                            <td class="visible-lg">
                                {% if item.getEventRoundC() %}
                                    <span class="label label-primary">{{ item.getEventRoundC() }}</span>
                                {% endif %}
                            </td>
                            <td class="visible-md visible-lg">
                                {% if item.getEventCityC() or item.getEventCountryC() %}
                                    <div>
                                        <i class="ri-map-pin-line mr-1"></i>
                                        {% if item.getEventCityC() %}
                                            {{ item.getEventCityC() }}
                                        {% endif %}
                                        {% if item.getEventCountryC() and item.getEventCityC() %}, {% endif %}
                                        {% if item.getEventCountryC() %}
                                            {{ item.getEventCountryC()|replace({'_': ' '}) }}
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </td>
                            <td class="visible-lg">
                                {% if item.getEventFieldC() %}
                                    <span class="label label-success">{{ item.getEventFieldC()|replace({'_': ' '}) }}</span>
                                {% endif %}
                            </td>
                            <td class="visible-md visible-lg">
                                {% if item.getActivityStatusType() %}
                                    {% set statusClass = item.getActivityStatusType() == 'active' ? 'success' : (item.getActivityStatusType() == 'inactive' ? 'danger' : 'warning') %}
                                    {% set statusIcon = item.getActivityStatusType() == 'active' ? 'ri-check-line' : (item.getActivityStatusType() == 'inactive' ? 'ri-close-line' : 'ri-time-line') %}
                                    <span class="label label-{{ statusClass }}">
                                        <i class="{{ statusIcon }} mr-1"></i>{{ item.getActivityStatusType()|title }}
                                    </span>
                                {% endif %}
                            </td>
                            <td class="visible-lg">
                                {% if item.getEventExternalId() %}
                                    <small class="text-muted">{{ item.getEventExternalId() }}</small>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="panel-footer">
                {{ include('@MauticCore/Helper/pagination.html.twig', {
                    'totalItems': items|length,
                    'page': page,
                    'limit': limit,
                    'baseUrl': path('mautic_event_index'),
                    'sessionVar': 'event'
                }) }}
            </div>
        </div>
    {% else %}
        {{ include('@MauticCore/Helper/noresults.html.twig') }}
    {% endif %}
{% endblock %}
